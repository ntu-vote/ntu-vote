(this["webpackJsonpvote-frontend"]=this["webpackJsonpvote-frontend"]||[]).push([[0],{121:function(e,t,a){},122:function(e,t,a){},131:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(39),s=a.n(c),o=(a(121),a(122),a(20)),i=a(0),l=a.n(i),u=a(4),p=a(179),d=a(186),j=a(166),b=a(173),x=a(185),m=a(175),h=a(187),f=a(183),g=a(184),O=a(178),v=a(138),y=a(88),k=a(181),w=a(2);function C(){return Object(w.jsxs)(v.a,{variant:"body2",color:"text.secondary",align:"center",children:["Copyright \xa9 ","ntu-vote"," ",(new Date).getFullYear(),"."]})}var S=function(){var e=Object(u.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://ntu-vote.ntu.im/api/login",e.prev=1,e.next=4,fetch("https://ntu-vote.ntu.im/api/login",{method:"POST",headers:{Accept:"application/json","Content-type":"application/json",Authorization:"bearer ".concat(t,":").concat(a)}});case 4:if(!(n=e.sent).ok){e.next=20;break}return e.next=8,n.json();case 8:if("Success"!==(r=e.sent).status){e.next=16;break}return localStorage.setItem("token",r.params.token),localStorage.setItem("username",r.params.username),localStorage.setItem("uid",r.params.uid),e.abrupt("return","success");case 16:return alert(r.message),e.abrupt("return","fail");case 18:e.next=22;break;case 20:return alert(n.status+" "+n.statusText),e.abrupt("return","fail");case 22:e.next=28;break;case 24:return e.prev=24,e.t0=e.catch(1),alert("\u767b\u5165\u5931\u6557\uff0c\u8acb\u78ba\u8a8d\u7db2\u8def\u9023\u7dda"),e.abrupt("return","fail");case 28:case"end":return e.stop()}}),e,null,[[1,24]])})));return function(t,a){return e.apply(this,arguments)}}(),I=Object(y.a)();function T(){var e=Object(o.e)(),t=function(){var t=Object(u.a)(l.a.mark((function t(a){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),n=new FormData(a.currentTarget),t.next=4,S(n.get("username"),n.get("password"));case 4:"success"===t.sent&&e.push("/home");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(w.jsx)("header",{className:"App-header",children:Object(w.jsx)(k.a,{theme:I,children:Object(w.jsxs)(O.a,{container:!0,component:"main",sx:{height:"100vh"},children:[Object(w.jsx)(j.a,{}),Object(w.jsx)(O.a,{item:!0,xs:!1,sm:4,md:7,sx:{backgroundImage:"url(".concat("","/background.jpg)"),backgroundRepeat:"no-repeat",backgroundColor:function(e){return"light"===e.palette.mode?e.palette.grey[50]:e.palette.grey[900]},backgroundSize:"cover",backgroundPosition:"center"}}),Object(w.jsx)(O.a,{item:!0,xs:12,sm:8,md:5,component:f.a,elevation:6,square:!0,children:Object(w.jsxs)(g.a,{sx:{my:8,mx:4,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{sx:{m:1},children:Object(w.jsx)("img",{src:"/favicon-32x32.png",alt:"sign-in-avatar-img"})}),Object(w.jsx)(v.a,{component:"h1",variant:"h5",children:"\u767b\u5165"}),Object(w.jsxs)(g.a,{component:"form",noValidate:!0,onSubmit:t,sx:{mt:1},children:[Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"\u5e33\u865f\u540d\u7a31\uff08\u82f1\u6578\u7d44\u5408\uff09",name:"username",autoComplete:"username",autoFocus:!0}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"\u5bc6\u78bc",type:"password",id:"password",autoComplete:"current-password"}),Object(w.jsx)(x.a,{control:Object(w.jsx)(m.a,{value:"remember",color:"primary"}),label:"\u8a18\u4f4f\u5bc6\u78bc"}),Object(w.jsx)(d.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"\u767b\u5165"}),Object(w.jsxs)(O.a,{container:!0,children:[Object(w.jsx)(O.a,{item:!0,xs:!0,children:Object(w.jsx)(h.a,{href:"#",variant:"body2",children:"\u5fd8\u8a18\u5bc6\u78bc?"})}),Object(w.jsx)(O.a,{item:!0,children:Object(w.jsx)(h.a,{href:"/register",variant:"body2",children:"\u5c1a\u672a\u6709\u5e33\u865f? \u8a3b\u518a"})})]}),Object(w.jsx)(C,{sx:{mt:5}})]})]})})]})})})}var A=a(36),D=function(){var e=Object(u.a)(l.a.mark((function e(t,a,n){var r,c,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("generating keys..."),e.prev=1,e.next=4,A.generateKey({type:"ecc",curve:"curve25519",userIDs:[{name:a,email:n}],passphrase:t,format:"armored"});case 4:return r=e.sent,c=r.privateKey,s=r.publicKey,o=r.revocationCertificate,e.abrupt("return",{privateKeyArmored:c,publicKeyArmored:s,revoCert:o});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return","fail");case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,a,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(u.a)(l.a.mark((function e(t,a,n,r,c){var s,o,i,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c+"@ntu.edu.tw",e.next=3,D(a,t,s);case 3:return o=e.sent,"https://ntu-vote.ntu.im/api/register",i=JSON.stringify({username:t,password:a,display_name:n,real_name:r,student_id:c,public_key:o.publicKeyArmored,private_key:o.privateKeyArmored}),e.next=8,fetch("https://ntu-vote.ntu.im/api/register",{method:"POST",body:i,headers:{Accept:"application/json","Content-type":"application/json"}});case 8:if(!(u=e.sent).ok){e.next=21;break}return e.next=12,u.json();case 12:if("Success"!==(p=e.sent).status){e.next=17;break}return e.abrupt("return","success");case 17:return alert(p.message),e.abrupt("return","fail");case 19:e.next=23;break;case 21:return alert(u.status+" "+u.statusText),e.abrupt("return","fail");case 23:case"end":return e.stop()}}),e)})));return function(t,a,n,r,c){return e.apply(this,arguments)}}(),K=Object(y.a)();function R(){var e=Object(o.e)(),t=function(){var t=Object(u.a)(l.a.mark((function t(a){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),n=new FormData(a.currentTarget),/^[a-z]{1}[0-9]{8}$/.test(n.get("studentId"))){t.next=7;break}return alert("\u5b78\u865f\u683c\u5f0f\u4e0d\u7b26"),t.abrupt("return");case 7:if(/^[A-Za-z0-9]+$/.test(n.get("username"))){t.next=12;break}return alert("\u7528\u6236\u540d\u7a31\u683c\u5f0f\u4e0d\u7b26"),t.abrupt("return");case 12:return t.next=14,E(n.get("username"),n.get("password"),n.get("displayName"),n.get("realName"),n.get("studentId"));case 14:"success"===t.sent&&(alert("\u8a3b\u518a\u6210\u529f"),e.push("/login"));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(w.jsx)("header",{className:"App-header",children:Object(w.jsx)(k.a,{theme:K,children:Object(w.jsxs)(O.a,{container:!0,component:"main",sx:{height:"100vh"},children:[Object(w.jsx)(j.a,{}),Object(w.jsx)(O.a,{item:!0,xs:!1,sm:4,md:7,sx:{backgroundImage:"url(".concat("","/background_clear.jpg)"),backgroundRepeat:"no-repeat",backgroundColor:function(e){return"light"===e.palette.mode?e.palette.grey[50]:e.palette.grey[900]},backgroundSize:"cover",backgroundPosition:"center"}}),Object(w.jsx)(O.a,{item:!0,xs:12,sm:8,md:5,component:f.a,elevation:6,square:!0,children:Object(w.jsxs)(g.a,{sx:{my:8,mx:4,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(w.jsx)(p.a,{sx:{m:1},children:Object(w.jsx)("img",{src:"/favicon-32x32.png",alt:"sign-up-avatar-img"})}),Object(w.jsx)(v.a,{component:"h1",variant:"h5",children:"\u8a3b\u518a"}),Object(w.jsxs)(g.a,{component:"form",noValidate:!0,onSubmit:t,sx:{mt:1},children:[Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"\u5e33\u865f\u540d\u7a31 \uff08\u4ee5\u5f8c\u767b\u5165\u4f7f\u7528\uff0c\u8acb\u8a18\u5f97\u60a8\u7684\u5e33\u865f\u540d\u7a31\uff09\uff08\u82f1\u6578\u7d44\u5408\uff09",name:"username",autoComplete:"username",autoFocus:!0}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,id:"displayName",label:"\u66b1\u7a31",name:"displayName",autoComplete:"displayName"}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,id:"realName",label:"\u771f\u5be6\u59d3\u540d",name:"realName",autoComplete:"realName"}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,id:"studentId",label:"\u5b78\u865f\uff08\u958b\u982d\u5c0f\u5beb e.g. b01001001\uff09",name:"studentId",autoComplete:"studentId"}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"\u5bc6\u78bc",type:"password",id:"password",autoComplete:"current-password"}),Object(w.jsx)(d.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"\u8a3b\u518a"}),Object(w.jsxs)(O.a,{container:!0,children:[Object(w.jsx)(O.a,{item:!0,xs:!0}),Object(w.jsx)(O.a,{item:!0,children:Object(w.jsx)(h.a,{href:"/login",variant:"body2",children:"\u5df2\u7d93\u8a3b\u518a\u904e\u5e33\u865f\u4e86\u55ce? \u767b\u5165"})})]}),Object(w.jsx)(C,{sx:{mt:5}})]})]})})]})})})}var W=a(15),F=a(188),N=a(189),z=a(190),P=a(192),_=a(191),q=a(193),B=a(194);function L(e){var t=e.campaign,a=e.showDuration,n=e.showResult,r="/voteStation?cpnId="+t.cpnId;return Object(w.jsx)(O.a,{item:!0,xs:12,md:12,children:Object(w.jsx)(_.a,{component:"a",href:r,children:Object(w.jsxs)(P.a,{sx:{display:"flex"},style:{backgroundColor:"#F8F8F8"},children:[Object(w.jsxs)(q.a,{sx:{flex:1},children:[Object(w.jsx)(v.a,{component:"h2",variant:"h3",gutterBottom:!0,children:t.title}),Object(w.jsx)(v.a,{variant:"h5",paragraph:!0,sx:{marginLeft:"40px",marginRight:"40px"},children:t.description}),Object(w.jsx)(v.a,{variant:"subtitle1",paragraph:!0,children:a(t)}),Object(w.jsx)(v.a,{variant:"subtitle1",color:"#D70040",paragraph:!0,children:n(t)})]}),Object(w.jsx)(B.a,{component:"img",sx:{width:160,display:{xs:"block",sm:"block"}},image:"https://source.unsplash.com/random",alt:"secondary-campaign-img"})]})})})}function V(){return Object(w.jsxs)(g.a,{sx:{bgcolor:"background.paper",p:6},component:"footer",children:[Object(w.jsx)(v.a,{variant:"subtitle1",align:"center",color:"text.secondary",component:"p",children:"\u6e2c\u8a66\u7248 Open Beta"}),Object(w.jsx)(C,{})]})}function M(e){return Object(w.jsxs)(f.a,{sx:{position:"relative",backgroundColor:"grey.800",color:"#fff",mb:4,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(https://source.unsplash.com/random)"},children:[Object(w.jsx)("img",{style:{display:"none"},src:"url(https://source.unsplash.com/random)",alt:"primary-campaign-img"}),Object(w.jsx)(g.a,{sx:{position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"rgba(0,0,0,.3)"}}),Object(w.jsx)(O.a,{container:!0,children:Object(w.jsx)(O.a,{item:!0,md:6,children:Object(w.jsx)(g.a,{sx:{position:"relative",p:{xs:3,md:6},pr:{md:0}}})})})]})}var J=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://ntu-vote.ntu.im/api/campaign",console.log("get campaign list..."),e.prev=2,e.next=5,fetch("https://ntu-vote.ntu.im/api/campaign",{method:"GET",headers:{Accept:"application/json","Content-type":"application/json",Authorization:"bearer ".concat(localStorage.getItem("username"),":").concat(localStorage.getItem("token"))}});case 5:if(!(t=e.sent).ok){e.next=18;break}return e.next=9,t.json();case 9:if("Success"!==(a=e.sent).status){e.next=14;break}return e.abrupt("return",a.result.campaigns);case 14:return alert(a.message),e.abrupt("return","fail");case 16:e.next=20;break;case 18:return alert(t.status+" "+t.statusText),e.abrupt("return","fail");case 20:e.next=26;break;case 22:return e.prev=22,e.t0=e.catch(2),alert("home page \u5df2\u9054\u767b\u5165\u6642\u9593\u4e0a\u9650\uff0c\u70ba\u78ba\u4fdd\u96b1\u79c1\u5b89\u5168\uff0c\u9ebb\u7169\u60a8\u5728\u767b\u5165\u4e00\u6b21\u5594"),e.abrupt("return","fail");case 26:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(){return e.apply(this,arguments)}}(),U=Object(y.a)();function G(){var e=Object(n.useState)([]),t=Object(W.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(!1),s=Object(W.a)(c,2),i=s[0],p=s[1],b=Object(o.e)(),x=function(e){if("ended"===e.status)return"\u6700\u9ad8\u5f97\u7968\u6578\uff1a".concat(e.result," \u7968")},m=function(e){return"ended"===e.status?"\u6295\u7968\u5df2\u7d50\u675f":"\u6295\u7968\u671f\u9650\uff1a".concat(e.startTime.slice(0,-7)," \u5230 ").concat(e.endTime.slice(0,-7))};return Object(n.useEffect)((function(){p(!0),Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:"fail"===(t=e.sent)?b.push("/login"):r(t),p(!1);case 5:case"end":return e.stop()}}),e)})))()}),[b]),i?"":0===a.length?Object(w.jsx)(v.a,{variant:"h6",color:"inherit",noWrap:!0,children:"\u73fe\u5728\u6c92\u6709\u4efb\u4f55\u6295\u7968\u6d3b\u52d5\u5594\uff01"}):Object(w.jsxs)(k.a,{theme:U,children:[Object(w.jsx)(j.a,{}),Object(w.jsx)(F.a,{position:"relative",style:{background:"#000000"},children:Object(w.jsxs)(N.a,{children:[Object(w.jsx)(O.a,{container:!0,justifyContent:"flex-start",children:Object(w.jsx)(v.a,{variant:"h6",color:"inherit",noWrap:!0,children:"NTU VOTE"})}),Object(w.jsx)(O.a,{container:!0,justifyContent:"flex-end",children:Object(w.jsx)(d.a,{variant:"outlined",onClick:function(){localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("uid"),b.push("/login")},style:{color:"#ffffff",border:"2px white solid"},children:"\u767b\u51fa"})})]})}),Object(w.jsxs)("main",{children:[Object(w.jsx)(M,{}),Object(w.jsx)(g.a,{sx:{bgcolor:"background.paper",pt:8,pb:6},children:Object(w.jsxs)(z.a,{maxWidth:"sm",children:[Object(w.jsxs)(v.a,{component:"h1",variant:"h2",align:"center",color:"text.primary",gutterBottom:!0,children:["NTU VOTE ",Object(w.jsx)("br",{}),"\u53f0\u5927\u5c08\u5c6c\u6295\u7968\u5e73\u53f0"]}),Object(w.jsx)(v.a,{variant:"h5",align:"center",color:"text.secondary",paragraph:!0,children:"\u64c7\u4f60\u6240\u611b\uff0c\u611b\u4f60\u6240\u9078\uff01\u6a21\u64ec\u516c\u6295\u706b\u71b1\u9032\u884c\u4e2d\uff01"})]})}),Object(w.jsx)(z.a,{sx:{py:8},children:Object(w.jsx)(O.a,{container:!0,spacing:4,children:a.slice(0).map((function(e){return Object(w.jsx)(L,{campaign:e,showDuration:m,showResult:x},e.cpn_id)}))})})]}),Object(w.jsx)(V,{})]})}var Y=a(22);function X(e){var t=e.candidate,a=e.live,r=e.handleSelect,c=e.campaignStatus;return Object(w.jsx)(O.a,{item:!0,xs:12,md:12,children:Object(w.jsxs)(P.a,{sx:{display:"flex"},style:{backgroundColor:"#F8F8F8"},children:[Object(w.jsx)(B.a,{component:"img",sx:{width:160,display:{xs:"block",sm:"block"}},image:"https://source.unsplash.com/random"}),Object(w.jsxs)(q.a,{sx:{flex:1},children:[Object(w.jsx)(v.a,{variant:"h3",gutterBottom:!0,children:t.name}),Object(w.jsx)(v.a,{variant:"h6",gutterBottom:!0,children:t.description}),t.policies.map((function(e,t){return Object(w.jsxs)(n.Fragment,{children:[Object(w.jsxs)(v.a,{variant:"h5",paragraph:!0,inline:"true",align:"left",paddingLeft:"20px",children:[t+1," ",e.title]}),Object(w.jsx)(v.a,{paragraph:!0,inline:"true",align:"left",children:e.description})]})})),a&&Object(w.jsxs)(v.a,{variant:"subtitle1",paragraph:!0,color:"#D70040",children:["\u5f97\u7968\u6578\uff1a",t.ballots," \u7968"]}),"ended"!==c&&Object(w.jsx)(d.a,{variant:"outline",size:"large",style:{color:"#000000",border:"2px black solid"},onClick:function(){r(t)},children:"\u6295\u7968"})]})]})})}var Z=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="https://ntu-vote.ntu.im/api/campaign/"+t,console.log("get candidate list..."),e.prev=2,e.next=5,fetch(a,{method:"GET",headers:{Accept:"application/json","Content-type":"application/json",Authorization:"bearer ".concat(localStorage.getItem("username"),":").concat(localStorage.getItem("token"))}});case 5:if(!(n=e.sent).ok){e.next=18;break}return e.next=9,n.json();case 9:if("Success"!==(r=e.sent).status){e.next=14;break}return e.abrupt("return",r.result);case 14:return alert(r.message),e.abrupt("return","fail");case 16:e.next=20;break;case 18:return alert(n.status+" "+n.statusText),e.abrupt("return","fail");case 20:e.next=26;break;case 22:return e.prev=22,e.t0=e.catch(2),alert("vote station \u5df2\u9054\u767b\u5165\u6642\u9593\u4e0a\u9650\uff0c\u70ba\u78ba\u4fdd\u96b1\u79c1\u5b89\u5168\uff0c\u9ebb\u7169\u60a8\u5728\u767b\u5165\u4e00\u6b21\u5594"),e.abrupt("return","fail");case 26:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=Object(u.a)(l.a.mark((function e(t,a,n){var r,c,s,o,i,u,p,d,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("signing messages..."),e.next=3,A.readKey({armoredKey:t.pubKey});case 3:return r=e.sent,e.t0=A,e.next=7,A.readPrivateKey({armoredKey:t.prvKey});case 7:return e.t1=e.sent,e.t2=a,e.t3={privateKey:e.t1,passphrase:e.t2},e.next=12,e.t0.decryptKey.call(e.t0,e.t3);case 12:return c=e.sent,e.next=15,A.createCleartextMessage({text:n});case 15:return s=e.sent,e.next=18,A.sign({message:s,signingKeys:c});case 18:return o=e.sent,e.next=21,A.readCleartextMessage({cleartextMessage:o});case 21:return i=e.sent,e.next=24,A.verify({message:i,verificationKeys:r});case 24:return u=e.sent,p=u.signatures[0],d=p.verified,j=p.keyID,e.prev=26,e.next=29,d;case 29:return e.abrupt("return",o);case 32:throw e.prev=32,e.t4=e.catch(26),console.log("sign by key id: ",j),new Error("Signature could not be verified: "+e.t4.message);case 36:case"end":return e.stop()}}),e,null,[[26,32]])})));return function(t,a,n){return e.apply(this,arguments)}}(),H=function(e){console.log("generating random string...");for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t},Q=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("get voter keys..."),e.prev=1,"https://ntu-vote.ntu.im/api/ballot/key",e.next=5,fetch("https://ntu-vote.ntu.im/api/ballot/key",{method:"GET",headers:{Accept:"application/json","Content-type":"application/json",Authorization:"bearer ".concat(localStorage.getItem("username"),":").concat(localStorage.getItem("token"))}});case 5:if(!(t=e.sent).ok){e.next=18;break}return e.next=9,t.json();case 9:if("Success"!==(a=e.sent).status){e.next=14;break}return e.abrupt("return",a.result);case 14:return alert(a.message),e.abrupt("return","fail");case 16:e.next=20;break;case 18:return alert(t.status+" "+t.statusText),e.abrupt("return","fail");case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e.catch(1),e.abrupt("return","fail");case 25:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=Object(u.a)(l.a.mark((function e(t,a,n){var r,c,s,o,i,u,p,d,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("casting ballots..."),e.prev=1,r=H(5),e.next=5,Q();case 5:return c=e.sent,s="VOTED:".concat(localStorage.getItem("uid"),":").concat(t),o="BALLOT:".concat(r,":").concat(t,":").concat(a),e.next=10,$(c,n,s);case 10:return i=e.sent,e.next=13,$(c,n,o);case 13:return u=e.sent,"https://ntu-vote.ntu.im/api/ballot/cast",p=JSON.stringify({cpnId:t,cid:a,votedProof:i,ballotProof:u}),e.next=18,fetch("https://ntu-vote.ntu.im/api/ballot/cast",{method:"POST",body:p,headers:{Accept:"application/json","Content-type":"application/json",Authorization:"bearer ".concat(localStorage.getItem("username"),":").concat(localStorage.getItem("token"))}});case 18:if(!(d=e.sent).ok){e.next=35;break}return e.next=22,d.json();case 22:if("Success"!==(j=e.sent).status){e.next=27;break}return e.abrupt("return",r);case 27:if(alert(j.message),"ERR_JWT_EXPIRED"!==j.message){e.next=31;break}return alert("\u5df2\u9054\u767b\u5165\u6642\u9593\u4e0a\u9650\uff0c\u70ba\u78ba\u4fdd\u96b1\u79c1\u5b89\u5168\uff0c\u9ebb\u7169\u60a8\u5728\u767b\u5165\u4e00\u6b21\u5594"),e.abrupt("return","expired");case 31:return"ERR_VOTER_ALREADY_VOTED"===j.message&&alert("\u4e00\u4eba\u4e00\u7968\uff0c\u60a8\u5df2\u6295\u904e\u6b64\u5834\u6d3b\u52d5"),e.abrupt("return","fail");case 33:e.next=37;break;case 35:return alert(d.status+" "+d.statusText),e.abrupt("return","fail");case 37:e.next=42;break;case 39:return e.prev=39,e.t0=e.catch(1),e.abrupt("return","fail");case 42:case"end":return e.stop()}}),e,null,[[1,39]])})));return function(t,a,n){return e.apply(this,arguments)}}(),te=a(180),ae=a(171),ne=a(195),re=a(196),ce=a(197),se=a(19),oe=a(198),ie={color:"#ffffff"};function le(e){var t=e.size;return Object(w.jsx)(g.a,{color:"secondary.main",pl:1.5,display:"flex",children:Object(w.jsx)(oe.a,{sx:Object(se.a)({},ie),size:t||24,thickness:t?t/5*24:5})})}var ue=a(172);function pe(e){var t=e.open,a=e.onClose,r=e.loading,c=e.name,s=e.onConfirm,o=Object(n.useRef)();return Object(w.jsxs)(te.a,{open:t,onClose:a,disableEscapeKeyDown:r,children:[Object(w.jsx)(ae.a,{children:"\u6295\u7968\u78ba\u8a8d"}),Object(w.jsxs)(ne.a,{children:[Object(w.jsxs)(re.a,{children:["\u78ba\u5b9a\u8981\u6295",c,"\u55ce\uff1f\u82e5\u662f\uff0c\u8acb\u8f38\u5165\u5bc6\u78bc\u65bc\u4e0b\u65b9\uff1a"]}),Object(w.jsx)(b.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"\u5bc6\u78bc",inputRef:o,type:"password",id:"password",autoComplete:"current-password"})]}),Object(w.jsx)(ce.a,{children:Object(w.jsxs)(ue.a,{sx:{pt:4},direction:"row",spacing:2,justifyContent:"center",children:[Object(w.jsxs)(d.a,{variant:"contained",onClick:function(){s(o.current.value)},disabled:r,style:{background:"#000000"},children:["\u78ba\u8a8d\u6295\u7968 ",r&&Object(w.jsx)(le,{})]}),Object(w.jsx)(d.a,{variant:"outlined",onClick:a,disabled:r,style:{color:"#000000",border:"2px black solid"},children:"\u95dc\u9589"})]})})]})}function de(e){var t=e.open,a=e.onClose,n=e.title,r=e.action,c=e.content;return Object(w.jsxs)(te.a,{open:t,onClose:a,children:[Object(w.jsxs)(ae.a,{children:["\u96a8\u6a5f\u9a57\u8b49\u78bc\uff1a",n]}),Object(w.jsx)(ne.a,{children:Object(w.jsx)(re.a,{children:c})}),Object(w.jsx)(ce.a,{children:Object(w.jsx)(d.a,{variant:"contained",onClick:a,style:{background:"#000000"},children:r})})]})}var je=["candidates"],be=Object(y.a)();function xe(e){var t=window.location,a=new URLSearchParams(t.search).get("cpnId"),r=Object(n.useState)(null),c=Object(W.a)(r,2),s=c[0],i=c[1],p=Object(n.useState)([]),b=Object(W.a)(p,2),x=b[0],m=b[1],h=Object(n.useState)(!1),f=Object(W.a)(h,2),y=f[0],C=f[1],S=Object(n.useState)(!1),I=Object(W.a)(S,2),T=I[0],A=I[1],D=Object(n.useState)(!1),E=Object(W.a)(D,2),K=E[0],R=E[1],P=Object(n.useState)(!1),_=Object(W.a)(P,2),q=_[0],B=_[1],L=Object(n.useState)(!1),M=Object(W.a)(L,2),J=M[0],U=M[1],G=Object(n.useState)({name:"default"}),$=Object(W.a)(G,2),H=$[0],Q=$[1],te=Object(o.e)(),ae=Object(n.useCallback)((function(e){if("ended"===e.status)return"\u6700\u9ad8\u5f97\u7968\u6578\uff1a".concat(e.result," \u7968")}),[]),ne=Object(n.useCallback)((function(e){return"ended"===e.status?"\u6295\u7968\u5df2\u7d50\u675f":"\u6295\u7968\u671f\u9650\uff1a".concat(e.startTime.slice(0,-7)," \u5230 ").concat(e.endTime.slice(0,-7))}),[]),re=Object(n.useCallback)((function(e){A(!0),Q(e)}),[A,Q]),ce=Object(n.useCallback)((function(){A(!1),R(!1)}),[A,R]),se=Object(n.useCallback)((function(){B(!1)}),[]),oe=Object(n.useCallback)((function(e){Object(u.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return R(!0),t.next=3,ee(s.cpnId,H.cid,e);case 3:a=t.sent,ce(),"fail"===a?alert("\u6295\u7968\u5931\u6557"):"expired"===a?te.push("/login"):(alert("\u6295\u7968\u6210\u529f!"),U(a),B(!0));case 6:case"end":return t.stop()}}),t)})))()}),[H,ce]);return Object(n.useEffect)((function(){Object(u.a)(l.a.mark((function e(){var t,n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!0),e.next=3,Z(a);case 3:"fail"===(t=e.sent)?te.push("/login"):(n=t.campaign,r=n.candidates,c=Object(Y.a)(n,je),i(c),m(r)),C(!1);case 6:case"end":return e.stop()}}),e)})))()}),[a,te]),y?"":0===x.length?Object(w.jsx)(v.a,{variant:"h6",color:"inherit",noWrap:!0,children:"\u76ee\u524d\u5c1a\u672a\u516c\u5e03\u8a73\u7d30\u8cc7\u8a0a\uff0c\u8acb\u904e\u5e7e\u5929\u518d\u4f86\u770b\u770b\u5427\uff01"}):Object(w.jsxs)(k.a,{theme:be,children:[Object(w.jsx)(j.a,{}),Object(w.jsx)(F.a,{position:"relative",style:{background:"#000000"},children:Object(w.jsxs)(N.a,{children:[Object(w.jsx)(O.a,{container:!0,justifyContent:"flex-start",children:Object(w.jsx)(v.a,{variant:"h6",color:"inherit",noWrap:!0,children:"NTU VOTE"})}),Object(w.jsxs)(O.a,{container:!0,justifyContent:"flex-end",children:[Object(w.jsx)(d.a,{variant:"outlined",href:"./home",style:{color:"#ffffff",border:"2px white solid",marginRight:"10px"},children:"\u56de\u5230\u6d3b\u52d5\u5217\u8868"}),Object(w.jsx)(d.a,{variant:"outlined",onClick:function(){window.location.reload()},style:{color:"#ffffff",border:"2px white solid",marginRight:"10px"},children:"\u91cd\u6574\u9801\u9762"}),Object(w.jsx)(d.a,{variant:"outlined",onClick:function(){localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("uid"),te.push("/login")},style:{color:"#ffffff",border:"2px white solid"},children:"\u767b\u51fa"})]})]})}),Object(w.jsxs)("main",{children:[Object(w.jsx)(g.a,{sx:{bgcolor:"background.black",pt:8,pb:6},children:Object(w.jsxs)(z.a,{maxWidth:"sm",children:[Object(w.jsxs)(v.a,{component:"h1",variant:"h4",align:"center",color:"text.primary",gutterBottom:!0,children:["\u6295\u7968\u6d3b\u52d5\u7de8\u865f\uff1a ",s.cpnId,Object(w.jsx)("br",{}),s.title]}),Object(w.jsx)(v.a,{variant:"h5",align:"center",color:"text.secondary",paragraph:!0,children:s.description}),Object(w.jsxs)(v.a,{variant:"subtitle1",align:"center",color:"text.secondary",children:["\u898f\u5247\uff1a",s.cpnr_id," ",s.rule.rule," \u2014 ",s.rule.description,Object(w.jsx)("br",{}),ne(s)]}),Object(w.jsx)(v.a,{variant:"subtitle1",align:"center",color:"#D70040",paragraph:!0,children:ae(s)})]})}),Object(w.jsx)(z.a,{sx:{py:8},children:Object(w.jsx)(O.a,{container:!0,spacing:4,children:x.map((function(e){return Object(w.jsx)(X,{candidate:e,live:s.rule.live,handleSelect:re,campaignStatus:s.status},e.cid)}))})}),Object(w.jsx)(pe,{open:T,name:H.name,onClose:ce,loading:K,onConfirm:oe}),Object(w.jsx)(de,{open:q,content:"\u4e0a\u65b9\u70ba\u60a8\u7684\u96a8\u6a5f\u9a57\u8b49\u78bc\uff0c\u7531\u65bc\u6b64\u5e73\u53f0\u4f7f\u7528\u533f\u540d\u6295\u7968\uff0c\u5f80\u5f8c\u82e5\u60a8\u9700\u9a57\u7968\uff0c\u8acb\u8a18\u4e0b\u6b64\u7d44\u96a8\u6a5f\u9a57\u8b49\u78bc\u4e26\u806f\u7d61\u6211\u5011\u3002\u70ba\u4e86\u60a8\u7684\u96b1\u79c1\uff0c\u8acb\u52ff\u5c07\u6b64\u7d44\u5bc6\u78bc\u544a\u8a34\u4ed6\u4eba",title:J,onClose:se,action:"\u6211\u77e5\u9053\u4e86"})]}),Object(w.jsx)(V,{})]})}function me(){return Object(w.jsxs)("div",{className:"App",children:[Object(w.jsx)(o.a,{path:"/login",component:T}),Object(w.jsx)(o.a,{path:"/register",component:R}),Object(w.jsx)(o.a,{path:"/voteStation",component:xe}),Object(w.jsx)(o.a,{path:"/home",component:G})]})}var he=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,199)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),c(e),s(e)}))},fe=a(73);s.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(fe.a,{children:Object(w.jsx)(me,{})})}),document.getElementById("root")),he()}},[[131,1,2]]]);
//# sourceMappingURL=main.275f2a53.chunk.js.map